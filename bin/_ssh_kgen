#!/bin/sh

echo -n "Key Type? (ecdsa|rsa) [ecdsa]>"
while true; do
	read keytype
	case "$keytype" in
		''|ecdsa|ec)
			keytype=ecdsa
			keystyp=ec
			break;;
		rsa)
			keystyp=rsa
			break;;
		*)
			echo -n "Again? >"
	esac
done

case "$keytype" in
	ecdsa)
		keybits=521
		keycand='521|256|128';;
	rsa)
		keybits=4096
		keycand='4096|2048|1024';;
esac

echo -n "Key bits? ($keycand) [$keybits]> "
while true; do
	read keybit
	case "$keybit" in
		'')
			keybit=$keybits
			break;;
		128|256|521)
			test $keytype = ecdsa && break;;
		1024|2048|4096)
			test $keytype = rsa && break;;
	esac
	echo -n "Again? >"
done

echo -n "Name? []> "
read keyname

comment="$(whoami)@$(hostname)"
if [ -z "$keyname" ]; then
	file="${HOME}/.ssh/id_$keytype"
else
	file="${HOME}/.ssh/${keystyp}_${keyname}"
	comment="${comment} for $keyname"
fi

echo "generating ssh key, ${keytype} ${keybit}bits into ${file}."

ssh-keygen -t ${keytype} -b ${keybit} -C "${comment}" -f ${file} || exit $?
echo
echo "Public Key:"
cat "${file}.pub"
