#! /bin/bash

#eclipsehome="${HOME}/eclipse"
workspace="${HOME}/workspace"
export MOZILLA_FIVE_HOME="${HOME}/lib/xulrunner/"
MYNAME="$(basename $0)"

function usage() {
  cat <<_EOM_ 1>&2
Usage: ${MYNAME} [workspace_name]
_EOM_
}


while getopts ho opt
do
  case ${opt} in
    h ) usage
        exit 0;;
    ? ) usage
         exit 1;;
  esac
done

shift $((${OPTIND} - 1))

if [ -z $1 ]
then
	echo "[${MYNAME}] missing operand 1: no workspace name"
	echo
	usage
	exit 1
fi

workspacehome="${workspace}/${1}"
eclipsehome="${workspacehome}/.eclipse"

if [ ! -e ${eclipsehome} ]
then
	echo "[${MYNAME}] not found: ${eclipsehome}"
	if [ ! -e ${workspacehome} ]; then
		usage
		exit 1
	fi
	echo ${eclipsehome} のリンク先: '(終了はCtrl+C)'
	select LINK in $(ls ${HOME}/eclipse/*/eclipse|cut -d'/' -f-5)
	do
		ln -s ${LINK} ${workspacehome}/.eclipse && echo 作成しました && break
	done
	exit 1
fi

if [ ! -d ${eclipsehome} ]
then
	echo "[${MYNAME}] ${eclipsehome} is NOT directory."
	return
fi

cd ${eclipsehome}

if [ ! -e "eclipse" ]
then
	echo "[${MYNAME}] not found: ${eclipsehome}/eclipse"
	exit 2
fi

if [ ! -x "eclipse" ]
then
	echo "[${MYNAME}] NOT executable file: ${eclipsehome}/eclipse"
	exit 2
fi

shift 1
echo eclipse -data "${workspacehome}" $@
./eclipse -data "${workspacehome}" $@ >/dev/null 2>&1 &

